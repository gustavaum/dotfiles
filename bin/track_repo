#!/bin/sh
function check_repo {
    local repo=$1
    [[ -z "$repo" ]] && die "repo not specified"
    [[ "$repo" =~ / ]] || die "\"$repo\" not in the proper nwo format"
}

function add_to_mr {
  local repo=$1
  name=`echo "$repo" | cut -d'/' -f2`
  grep -q $repo ~/.mrconfig
  if [ $? -eq 0 ]; then
    echo "$name is already set up in mr. Not adding"
  else
  echo "Adding \"$name\" to mr"
  echo -e "\n[\$HOME/Code/livingsocial/$name]" >> ~/.mrconfig
  echo "checkout = git clone livingsocial:$repo" >> ~/.mrconfig
  fi
}

function die {
    echo $@
    exit 1
}

REPO=$1
TMUX_SWITCH=$2
check_repo "$REPO"
add_to_mr "$REPO"
repo_name=`echo "$REPO" | cut -d'/' -f2`

pushd ~/Code/livingsocial
mr checkout
popd

[[ -n $TMUX_SWITCH ]] && cp -v ~/Code/livingsocial/ls-tmux.conf ~/Code/livingsocial/$repo_name/.tmux

